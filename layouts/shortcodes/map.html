{{- $coordinatesJson := .Get "coordinates" }}
{{- $coordinates := $coordinatesJson | transform.Unmarshal }}
{{ $random := math.Rand }}

<div id="map{{ $random }}" class="map"></div>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
    function initializeMap(mapId, coordinates) {
        var map = L.map(mapId).setView([0, 0], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        var waypoints = coordinates.map(function(coord) {
            return L.latLng(coord.x, coord.y);
        });

        L.Routing.control({
            show: false,
            collapsible: true,
            waypoints: waypoints,
            routeWhileDragging: false
        }).addTo(map);

        map.fitBounds(waypoints);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const coordinates = [
            {{- range $coordinates }}
                { x: {{ .x }}, y: {{ .y }} },
            {{- end }}
        ];
        initializeMap('map{{ $random }}', coordinates);
    });
</script>
